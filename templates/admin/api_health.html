{% extends "base.html" %}

{% block title %}API Health - IT Quizbee Admin{% endblock %}

{% block header %}{% endblock %}

{% block content %}
<div class="flex min-h-screen bg-gray-50">
    <!-- Sidebar -->
    {% include 'partials/admin_sidebar.html' %}

    <!-- Main Content Area -->
    <main class="flex-1 ml-64 p-8">
        <!-- Page Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">API Health & System Status</h1>
            <p class="text-gray-600">Monitor API endpoints and system performance</p>
        </div>

        <!-- API Health Section -->
        <section id="api-health">
            <!-- Health Status Card -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-bold text-gray-800 flex items-center">
                        <i class="bi bi-heart-pulse-fill text-green-600 mr-2"></i>
                        System Status
                    </h3>
                    <button onclick="checkHealth()"
                        class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
                        <i class="bi bi-arrow-clockwise mr-2"></i>Refresh
                    </button>
                </div>

                <div id="health-status" class="space-y-4">
                    <div class="flex items-center justify-center py-8">
                        <div
                            class="inline-block animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-indigo-600">
                        </div>
                    </div>
                </div>
            </div>

            <!-- API Endpoints -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="bi bi-plug-fill text-indigo-600 mr-2"></i>
                    API Endpoints
                </h3>
                <div class="space-y-3">
                    <div class="p-4 border-l-4 border-green-500 bg-green-50 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-semibold text-gray-800">GET /api/health</p>
                                <p class="text-sm text-gray-600">System health check</p>
                            </div>
                            <a href="/api/health" target="_blank"
                                class="px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700 transition">
                                Test <i class="bi bi-box-arrow-up-right ml-1"></i>
                            </a>
                        </div>
                    </div>

                    <div class="p-4 border-l-4 border-blue-500 bg-blue-50 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-semibold text-gray-800">GET /api/statistics</p>
                                <p class="text-sm text-gray-600">Get quiz statistics</p>
                            </div>
                            <a href="/api/statistics" target="_blank"
                                class="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition">
                                Test <i class="bi bi-box-arrow-up-right ml-1"></i>
                            </a>
                        </div>
                    </div>

                    <div class="p-4 border-l-4 border-purple-500 bg-purple-50 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-semibold text-gray-800">GET /api/statistics/export</p>
                                <p class="text-sm text-gray-600">Export analytics data</p>
                            </div>
                            <a href="/api/statistics/export"
                                class="px-3 py-1 bg-purple-600 text-white rounded text-sm hover:bg-purple-700 transition">
                                Download <i class="bi bi-download ml-1"></i>
                            </a>
                        </div>
                    </div>

                    <div class="p-4 border-l-4 border-orange-500 bg-orange-50 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-semibold text-gray-800">POST /api/questions/report</p>
                                <p class="text-sm text-gray-600">Report a question issue</p>
                            </div>
                            <span class="px-3 py-1 bg-orange-600 text-white rounded text-sm">
                                POST Only
                            </span>
                        </div>
                    </div>

                    <div class="p-4 border-l-4 border-yellow-500 bg-yellow-50 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-semibold text-gray-800">PATCH /api/admin/reports/:id/status</p>
                                <p class="text-sm text-gray-600">Update report status</p>
                            </div>
                            <span class="px-3 py-1 bg-yellow-600 text-white rounded text-sm">
                                PATCH Only
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="bi bi-lightning-fill text-yellow-600 mr-2"></i>
                    Quick Actions
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button onclick="window.location.reload()"
                        class="px-4 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition flex items-center justify-center gap-2">
                        <i class="bi bi-arrow-clockwise"></i>
                        Refresh Page
                    </button>
                    <a href="/api/statistics/export"
                        class="px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition flex items-center justify-center gap-2">
                        <i class="bi bi-download"></i>
                        Export Data
                    </a>
                    <a href="/api/health" target="_blank"
                        class="px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition flex items-center justify-center gap-2">
                        <i class="bi bi-code-square"></i>
                        API Health JSON
                    </a>
                </div>
            </div>
        </section>
        {% endblock %}

        {% block extra_js %}
        <script>
            // Check API health on page load
            document.addEventListener('DOMContentLoaded', function () {
                checkHealth();
            });

            async function checkHealth() {
                const statusDiv = document.getElementById('health-status');
                statusDiv.innerHTML = `
            <div class="flex items-center justify-center py-8">
                <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-indigo-600"></div>
            </div>
        `;

                try {
                    const response = await fetch('/api/health');
                    const data = await response.json();

                    if (data.status === 'healthy') {
                        statusDiv.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="p-4 bg-green-50 rounded-lg border-l-4 border-green-500">
                            <div class="flex items-center gap-3">
                                <i class="bi bi-check-circle-fill text-3xl text-green-600"></i>
                                <div>
                                    <p class="text-sm text-gray-600">Status</p>
                                    <p class="text-xl font-bold text-green-600">Healthy</p>
                                </div>
                            </div>
                        </div>

                        <div class="p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                            <div class="flex items-center gap-3">
                                <i class="bi bi-database-fill text-3xl text-blue-600"></i>
                                <div>
                                    <p class="text-sm text-gray-600">Database</p>
                                    <p class="text-xl font-bold text-blue-600">${data.database}</p>
                                </div>
                            </div>
                        </div>

                        <div class="p-4 bg-purple-50 rounded-lg border-l-4 border-purple-500">
                            <div class="flex items-center gap-3">
                                <i class="bi bi-clock-fill text-3xl text-purple-600"></i>
                                <div>
                                    <p class="text-sm text-gray-600">Timestamp</p>
                                    <p class="text-sm font-medium text-purple-600">${new Date(data.timestamp).toLocaleString()}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                    } else {
                        throw new Error('Unhealthy status');
                    }
                } catch (error) {
                    statusDiv.innerHTML = `
                <div class="p-6 bg-red-50 rounded-lg border-l-4 border-red-500">
                    <div class="flex items-center gap-3">
                        <i class="bi bi-x-circle-fill text-4xl text-red-600"></i>
                        <div>
                            <p class="text-xl font-bold text-red-600">API Unavailable</p>
                            <p class="text-sm text-gray-600 mt-1">Failed to connect to the API endpoint</p>
                            <p class="text-xs text-gray-500 mt-2">Error: ${error.message}</p>
                        </div>
                    </div>
                </div>
            `;
                }
            }
        </script>
    </main>
</div>
{% endblock %}